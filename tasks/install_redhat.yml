---

# Manage Collectd install on RedHat systems

- name: 'INSTALL | {{ ansible_pkg_mgr | upper }} | Install collectd'
  become: True
  yum:
    name: "{{ item }}"
    state: "{{ collectd_package_state }}"
    disablerepo: "{{ collectd_disabled_repos|default('') }}"
    enablerepo: "{{ collectd_enabled_repos|default('') }}"
  with_items: "{{ collectd_packages }}"
  notify: 'HANDLER | Restart collectd'
  when:
    - ansible_pkg_mgr == 'yum'


- name: 'INSTALL | YUM | Install collectd plugins dependencies'
  become: True
  yum:
    name: "{{ item }}"
    state: "{{ collectd_package_state }}"
    disablerepo: "{{ collectd_disabled_repos|default('') }}"
    enablerepo: "{{ collectd_enabled_repos|default('') }}"
  with_items: "{{ collectd_plugins_with_dependencies
                  | map('extract', collectd_plugins_dependencies)
                  | list }}"
  when:
    - "{{ (collectd_plugins_dependencies | length) > 0 }}"
    - ansible_pkg_mgr == 'yum'
  notify: 'HANDLER | Restart collectd'
